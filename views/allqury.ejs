<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Queries</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        h1 { color: #555; text-align: center; }
        .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;}
        .controls select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; }
        .controls .btn { padding: 10px 15px; background-color: #007BFF; color: white; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; font-size: 16px;}
        .query-link { text-decoration: none; color: inherit; }
        .query-card { background-color: #e9e9e9; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        .query-card-content:hover { text-decoration: underline; }
        .query-card h3 { margin-top: 5px; margin-bottom: 10px; }
        .query-card p { margin-bottom: 5px; }
        .query-card .category { font-weight: bold; color: #007BFF; }
        .query-card .user { font-style: italic; color: #6c757d; font-size: 0.9em;}

        /* --- New styles for the vote section --- */
        .vote-section { display: flex; align-items: center; gap: 20px; margin-top: 15px; }
        .vote-control { display: flex; align-items: center; gap: 8px; }
        .vote-button { background: none; border: none; padding: 0; font-size: 1.2rem; cursor: pointer; color: #555; transition: transform 0.2s; }
        .vote-button:hover { transform: scale(1.2); }
        .vote-count { font-weight: bold; font-size: 1rem; color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>All Queries</h1>

        <div class="controls">
            <a href="/addqury" class="btn">Ask a Question</a>
            <select id="categoryFilter" name="category" aria-label="Filter by category">
                <option value="">All Categories</option>
                <% if(locals.categories) { categories.forEach(cat => { %>
                    <option value="<%= cat %>" <%= locals.selectedCategory === cat ? 'selected' : '' %>>
                        <%= cat %>
                    </option>
                <% }) } %>
            </select>
        </div>
        
        <% if (queries && queries.length > 0) { %>
            <% for (let query of queries) { %>
                <div class="query-card">
                    <a href="/allqury/<%= query._id %>" class="query-link query-card-content">
                        <p class="user">User: <%= query.user %></p>
                        <p class="category">Category: <%= query.category %></p>
                        <h3><%= query.msg %></h3>
                    </a>
                    
                    <div class="vote-section">
                        <div class="vote-control">
                             <form action="/allqury/<%= query._id %>/upvote" method="POST" class="d-inline">
                                <button type="submit" class="vote-button" aria-label="Upvote">
                                    <i class="fa-solid fa-arrow-up"></i>
                                </button>
                            </form>
                            <span class="vote-count"><%= query.upvotes %></span>
                        </div>
                        
                        <div class="vote-control">
                             <form action="/allqury/<%= query._id %>/downvote" method="POST" class="d-inline">
                                <button type="submit" class="vote-button" aria-label="Downvote">
                                    <i class="fa-solid fa-arrow-down"></i>
                                </button>
                            </form>
                            <span class="vote-count"><%= query.downvotes %></span>
                        </div>
                    </div>
                    </div>
            <% } %>
        <% } else { %>
            <p>No queries found.</p>
        <% } %>
    </div>

    <script>
        document.getElementById('categoryFilter').addEventListener('change', function() {
            const category = this.value;
            if (category) {
                window.location.href = `/allqury?category=${encodeURIComponent(category)}`;
            } else {
                window.location.href = '/allqury';
            }
        });
    </script>
</body>
</html>